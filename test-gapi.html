<!DOCTYPE html>
<html>
<head>
    <title>Google API Test</title>
</head>
<body>
    <h1>Google API Loading Test</h1>
    <div id="status">Checking Google API...</div>
    <div id="details"></div>
    
    <script>
        // Track loading steps
        let loadSteps = [];
        
        window.gapiLoadedPromise = new Promise((resolve, reject) => {
            window.gapiLoadedResolve = resolve;
            window.gapiLoadedReject = reject;
        });
        
        // Google's callback when gapi is ready
        window.gapi_onload = function() {
            loadSteps.push('gapi_onload callback fired');
            document.getElementById('status').innerHTML = '✅ Google API loaded via gapi_onload callback';
            if (window.gapiLoadedResolve) {
                window.gapiLoadedResolve();
                clearTimeout(window.gapiLoadTimeout);
            }
            
            // Check if gapi is available
            setTimeout(() => {
                if (typeof gapi !== 'undefined') {
                    document.getElementById('details').innerHTML = '<br>✅ gapi object is available<br>✅ Ready to use Google Calendar API';
                    loadSteps.push('gapi object confirmed available');
                } else {
                    document.getElementById('details').innerHTML = '<br>❌ gapi object is NOT available (unexpected)';
                    loadSteps.push('gapi object NOT available (error)');
                }
                console.log('Load steps:', loadSteps);
            }, 100);
        };
        
        window.gapiLoadTimeout = setTimeout(() => {
            loadSteps.push('Timeout reached');
            document.getElementById('status').innerHTML = '❌ Google API script timed out';
            window.gapiLoadFailed = true;
            if (window.gapiLoadedReject) {
                window.gapiLoadedReject(new Error('Timeout'));
            }
        }, 15000);
        
        // Track script loading
        loadSteps.push('Starting to load Google API script');
    </script>
    
    <script src="https://apis.google.com/js/api.js" 
        onerror="loadSteps.push('Script load error'); document.getElementById('status').innerHTML = '❌ Google API failed to load'; window.gapiLoadFailed = true; if(window.gapiLoadedReject) { window.gapiLoadedReject(new Error('Script load failed')); }">
    </script>
</body>
</html>